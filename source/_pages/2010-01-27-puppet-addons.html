--- 
layout: page
title: Puppet addons
tags: 
- facter
- puppet
- ruby
status: publish
type: page
published: true
meta: 
  jd_tweet_this: "yes"
  _edit_lock: "1284472125"
  _edit_last: "1"
  _wp_page_template: default
  wp_jd_bitly: http://bit.ly/chDATs
  wp_jd_target: http://www.linuxaddicted.de/blog/projects/puppet-addons/
---
I have made some extension for <a href="http://projects.reductivelabs.com/projects/facter">Facter</a> to match my requirements. Most of these extensions are only useful for Gentoo installations. Please leave a comment if you like the addons.

<!-- more -->

<h2>gcc_profile.rb</h2>
<p>&nbsp;</p>
Facter plugin to get the currently active GCC profile on <a href="http://www.gentoo.org">Gentoo</a> installations. It may work on other distributions too.

<img class="aligncenter size-full wp-image-274" title="gcc_profile screenshot" src="http://www.linuxaddicted.de/blog/wp-content/uploads/2010/01/Picture-20.png" alt="gcc_profile screenshot" width="421" height="43" />
<p>&nbsp;</p>

<pre lang="ruby">Facter.add(:gcc_profile) do
    confine :operatingsystem => :Gentoo
    setcode do
        profile = nil
        output = %x{/usr/bin/gcc-config -c}
        profile = output.chop!
        profile
    end
end
</pre>

<h2>system_profile.rb</h2>
<p>&nbsp;</p>
Facter plugin to get the currently active <a href="http://www.gentoo.org">Gentoo</a> system profile. Plugin uses eselect so you need to have it installed.

<img class="aligncenter size-full wp-image-285" title="system profile" src="http://www.linuxaddicted.de/blog/wp-content/uploads/2010/01/Picture-21.png" alt="system profile" width="312" height="55" />
<p>&nbsp;</p>

<pre lang="ruby">Facter.add(:system_profile) do
    confine :operatingsystem => :Gentoo
    setcode do
        profile = nil
        output = %x{/usr/bin/eselect --brief --no-color profile show | tr -d ' '}
        profile = output.chop!
        profile
    end
end
</pre>

<h2>default_gw.rb</h2>
<p>&nbsp;</p>

Facter plugin to return the deault gw set in systems routing table. Requires iproute2 package installed.

<pre lang="ruby">
Facter.add(:default_gw) do
    confine :kernel => :linux
    setcode do
        gw = nil
        output = %x{/sbin/ip route show}

        output.each { |line|
            if line =~ /^default\s+via\s+([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})/
                gw = $1
                break
            end
        }
        gw
    end
end
</pre>
